<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Creative Digital CV ‚Äî Step 3: Work & Experience</title>

  <!-- Branding -->
  <link rel="icon" href="icons/logo.png">
  <meta name="theme-color" content="#7c3aed">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/app.css">

  <!-- Page-specific styles -->
  <style>
    /* ====== Timeline (horizontal) ====== */
    .timeline {
      background: var(--card);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 16px 18px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 22px;
      position: relative;
      overflow: hidden;
    }
    .timeline::before{ display:none; } /* no gray line */

    .tl-item{
      position:relative;
      z-index:1;
      display:grid;
      grid-template-columns: 32px 1fr;
      column-gap:12px;
      align-items:start;
    }
    .tl-dot{
      width:32px;height:32px;border-radius:999px;
      display:grid;place-items:center;font-weight:800;color:#fff;
      background:#cbd5e1;
      box-shadow:0 6px 14px rgba(2,6,23,.08);
    }
    .tl-item.done .tl-dot,
    .tl-item.current .tl-dot{
      background:linear-gradient(135deg,var(--brand),var(--brand-2));
      box-shadow:0 10px 22px rgba(124,58,237,.28);
    }
    .tl-copy b{display:block;margin:0 0 2px}
    .tl-copy small{display:block;color:var(--muted);line-height:1.25}
    .tl-link{text-decoration:none;color:inherit}
    .tl-link:hover{text-decoration:none}

    /* ====== Form + list ====== */
    .form-card{
      background:var(--card);border-radius:18px;
      box-shadow:var(--shadow);padding:22px;
    }
    label{font-weight:700;display:block;margin:10px 0 6px}
    input,textarea{
      width:100%;border:1px solid #e5e7eb;border-radius:12px;
      padding:10px 12px;font:inherit;
    }
    textarea{min-height:120px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:700px){.row{grid-template-columns:1fr}}
    .hint{color:var(--muted);font-size:13px}
    .actions{display:flex;justify-content:space-between;margin-top:18px;gap:10px;flex-wrap:wrap}
    .btn-secondary{
      padding:10px 14px;border:1px solid #e5e7eb;background:#fff;
      border-radius:12px;font-weight:700;color:var(--brand);
      cursor:pointer;display:inline-block;text-decoration:none;
    }
    .btn-secondary:hover{text-decoration:none}
    .btn-line{
      padding:10px 14px;border:1px dashed #cbd5e1;background:#fff;
      border-radius:12px;font-weight:700;cursor:pointer;
    }
    .error{color:#ef4444;font-size:13px;margin-top:6px;display:none}

    /* List of added experiences */
    .exp-list{margin-top:18px;display:grid;gap:10px}
    .exp-item{
      border:1px solid #eef2f7;background:#fafbff;border-radius:14px;
      padding:12px 14px;display:flex;gap:12px;align-items:flex-start;justify-content:space-between;
    }
    .exp-head{font-weight:700}
    .exp-meta{color:#0f172a;font-weight:700}
    .exp-actions{display:flex;gap:8px}
    .chip{font-size:12px;padding:4px 8px;border-radius:999px;background:#eef2ff;border:1px solid #dbe4ff}
    .link{color:var(--brand);font-weight:700;text-decoration:none;cursor:pointer}
    .link:hover{text-decoration:none}
/* === Step 3 ‚Üí make timeline match Step 1/2 (add-only overrides) === */
.timeline{ grid-template-columns: repeat(6,1fr) !important; }
.timeline::before{ display:none !important; }           /* hide any rail */
.tl-item{ grid-template-columns:32px 1fr !important; }  /* same grid as step1/2 */
.tl-dot{
  width:32px;height:32px;border-radius:999px;
  display:grid;place-items:center;font-weight:800;color:#fff;
  background:#cbd5e1;box-shadow:0 6px 14px rgba(2,6,23,.08);
}
.tl-item.done .tl-dot,
.tl-item.current .tl-dot{
  background:linear-gradient(135deg,var(--brand),var(--brand-2)) !important;
  box-shadow:0 10px 22px rgba(124,58,237,.28);
}
.timeline b,.timeline small,.tl-link{text-decoration:none!important}

/* responsive like step1/2 */
@media (max-width:1100px){
  .timeline{ grid-template-columns:1fr 1fr !important; }
}
   .back a{
      display:inline-block;padding:8px 14px;border-radius:12px;background:rgba(255,255,255,.12);
      color:#fff;font-weight:700;text-decoration:none;border:1px solid rgba(255,255,255,.3);transition:.25s ease;
    }
    .back a:hover,.back a:focus-visible{background:rgba(255,255,255,.22);box-shadow:var(--ring)}

    /* Validation error message for summary textarea (hidden by default). */
    .error{color:#ef4444;font-size:13px;margin-top:6px;display:none}

    /* When invalid, add a red border + subtle red focus ring. */
    textarea[aria-invalid="true"]{border-color:#ef4444;box-shadow:0 0 0 3px rgba(239,68,68,.15)}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- Header -->
  <header class="header" role="banner">
    <div class="brand">
      <img src="icons/logo.png" alt="Creative Digital CV logo" />
      <span>Creative Digital CV</span>
    </div>

    <button class="hamburger" id="hamburger" aria-label="Toggle menu" aria-expanded="false" aria-controls="mainnav">‚ò∞</button>

    <nav class="nav" id="mainnav" aria-label="Main">
      <a href="index.html">Dashboard</a>
      <a href="cv-templates.html">CV Templates</a>
      <a href="career-path.html">Career Path</a>
    </nav>

    <div class="back"><a href="index.html">Back to site</a></div>
  </header>
  <!-- Main -->
  <main id="main" class="wrap" role="main" aria-labelledby="page-title">

    <!-- ====== Timeline (Steps 1‚Äì4) ====== -->
    <section class="timeline" style="margin-top:14px;">
      <a class="tl-link tl-item done" href="step1-personal.html">
        <div class="tl-dot">1</div>
        <div class="tl-copy">
          <b>Personal Information</b>
          <small>Full name, email, phone, location, LinkedIn.</small>
        </div>
      </a>

      <a class="tl-link tl-item done" href="step2-summary.html">
        <div class="tl-dot">2</div>
        <div class="tl-copy">
          <b>Professional Summary</b>
          <small>2‚Äì4 lines highlighting strengths and goals.</small>
        </div>
      </a>

      <div class="tl-item current" aria-current="step">
        <div class="tl-dot">3</div>
        <div class="tl-copy">
          <b>Work & Experience</b>
          <small>Record job roles, internships, and achievements.</small>
        </div>
      </div>

      <div class="tl-item upcoming">
        <div class="tl-dot">4</div>
        <div class="tl-copy">
          <b>Finalize & Download</b>
          <small>Review & download the ATS-optimized PDF.</small>
        </div>
      </div>
    </section>

    <!-- ====== Experience Form ====== -->
    <section class="form-card" style="margin-top:22px;" aria-label="Experience form">
      <h1 id="page-title" style="margin:0 0 8px;">Step 3 ‚Äî Work & Experience</h1>
      <p class="hint">Add your most recent experience first. Use ‚ÄúAdd experience‚Äù to insert multiple entries.</p>

      <form id="expForm" novalidate>
        <label for="title">Job Title / Role</label>
        <input id="title" type="text" placeholder="e.g., SOC Intern or IT Support Engineer">

        <label for="company">Company / Organization</label>
        <input id="company" type="text" placeholder="e.g., Saudi German Hospital">

        <div class="row">
          <div>
            <label for="start">Start Date</label>
            <input id="start" type="month">
          </div>
          <div>
            <label for="end">End Date (leave blank if current)</label>
            <input id="end" type="month">
          </div>
        </div>

        <label for="location">Location</label>
        <input id="location" type="text" placeholder="City, Country">

        <label for="desc">Description / Key Achievements</label>
        <textarea id="desc" placeholder="Briefly describe what you did, technologies used, and your impact‚Ä¶"></textarea>
        <div class="error" id="err_desc">Please add a brief description (min 50 characters).</div>

        <div class="actions">
          <a class="btn-secondary" href="step2-summary.html">‚Üê Back to Step 2</a>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn-line" type="button" id="addMore">Ôºã Add experience</button>
            <button class="btn-primary" type="submit" id="saveNext">Save & Continue</button>
          </div>
        </div>
      </form>

      <!-- List of added experiences -->
      <div id="expList" class="exp-list" aria-live="polite"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="foot">
      <div>¬© 2025 Creative Digital CV ‚Äî Version 1.0 Beta | Made with love in SEU üíú</div>
      <div style="display:flex;gap:16px;flex-wrap:wrap">
        <a href="terms.html">Terms & Conditions</a>
        <a href="privacy.html">Privacy</a>
        <a href="faqs.html">FAQs</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <!-- Shared JS -->
  <script src="js/app.js"></script>

  <!-- Page logic -->
  <script>
    (function(){
      const storeKey = 'cvsenior-step3-exp';
      const builderKey = 'cvsenior-builder';

      const $ = s => document.querySelector(s);
      const expList = $('#expList');

      // Load saved list (array)
      let list = [];
      try {
        const saved = JSON.parse(localStorage.getItem(storeKey) || '[]');
        if (Array.isArray(saved)) list = saved;
      } catch {}

      // Prefill last typed (optional) ‚Äì not needed since we add/clear each time

      // Helpers
      function fmtMonth(v){ if(!v) return ''; const [y,m]=v.split('-'); return (m?m.padStart(2,'0'):'')+'/'+y; }

      function renderList(){
        expList.innerHTML = '';
        if(!list.length){
          expList.innerHTML = '<div class="chip">No experiences added yet.</div>';
          return;
        }
        list.forEach((x,idx)=>{
          const item = document.createElement('div');
          item.className = 'exp-item';
          const dates = (fmtMonth(x.start)||'') + (x.end ? ' ‚Äì ' + fmtMonth(x.end) : ' ‚Äì Present');
          item.innerHTML = `
            <div style="flex:1">
              <div class="exp-head">${escapeHtml(x.title||'')} <span class="hint">‚Äî ${escapeHtml(x.company||'')}</span></div>
              <div class="hint">${escapeHtml(x.location||'')}</div>
              <div style="margin-top:6px">${escapeHtml(x.desc||'')}</div>
            </div>
            <div class="exp-actions">
              <div class="exp-meta">${escapeHtml(dates)}</div>
              <button class="btn-line" data-del="${idx}" type="button" title="Remove">üóë Remove</button>
            </div>
          `;
          expList.appendChild(item);
        });
        // bind delete
        expList.querySelectorAll('[data-del]').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const i = +btn.getAttribute('data-del');
            list.splice(i,1);
            persistList();
            renderList();
          });
        });
      }

      function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]));}

      function persistList(){
        localStorage.setItem(storeKey, JSON.stringify(list));
        // also mirror into builder state
        try{
          const state = JSON.parse(localStorage.getItem(builderKey)||'{}');
          state.sections ??= {};
          state.sections.exp = list.slice(); // copy
          localStorage.setItem(builderKey, JSON.stringify(state));
        }catch{}
      }

      function fetchForm(){
        return {
          title: $('#title').value.trim(),
          company: $('#company').value.trim(),
          start: $('#start').value,
          end: $('#end').value,
          location: $('#location').value.trim(),
          desc: $('#desc').value.trim()
        };
      }

      function validateDesc(){
        const desc = $('#desc');
        const err = $('#err_desc');
        if(desc.value.trim().length < 50){
          desc.setAttribute('aria-invalid','true');
          err.style.display='block';
          return false;
        }
        err.style.display='none';
        desc.removeAttribute('aria-invalid');
        return true;
      }

      function clearForm(){
        ['title','company','start','end','location','desc'].forEach(id=>{
          const el = document.getElementById(id);
          if(el) el.value = '';
        });
      }

      // Add another experience (stays on page)
      $('#addMore').addEventListener('click', ()=>{
        if(!validateDesc()) return;
        const data = fetchForm();
        list.unshift(data);
        persistList();
        renderList();
        clearForm();
        window.scrollTo({ top: expList.offsetTop - 80, behavior: 'smooth' });
      });

      // Save & Continue (ensures current form entry is saved if filled)
      $('#expForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const cur = fetchForm();
        const anyFilled = Object.values(cur).some(v => (v||'').toString().trim() !== '');
        if(anyFilled){
          if(!validateDesc()) return;
          list.unshift(cur);
          persistList();
        } else {
          // nothing new typed; just persist existing list
          persistList();
        }
        // Next step (builder or step4)
        window.location.href = 'step4-certificates.html';
      });

      // Init view
      renderList();
    })();
  </script>
<script>
(function(){
  const tl = document.querySelector('section.timeline');
  if(!tl || tl.dataset.upgraded) return;
  tl.dataset.upgraded = 'true';

  const steps = [
    {n:1, label:'Personal Info', sub:'Contact & profile.', href:'step1-personal.html', done:true},
    {n:2, label:'Summary',       sub:'2‚Äì4 lines.',         href:'step2-summary.html', done:true},
    {n:3, label:'Experience',    sub:'Roles & impact.',    current:true},
    {n:4, label:'Certificates',  sub:'Issuer & expiry.'},
    {n:5, label:'Skills & Lang', sub:'Tech, soft, languages.'},
    {n:6, label:'Design',        sub:'Choose template & theme.'},
  ];

  tl.innerHTML = steps.map(s=>{
    const cls = `tl-item${s.done?' done':''}${s.current?' current':''}`;
    if(s.href){
      return `<a class="tl-link ${cls}" href="${s.href}">
                <div class="tl-dot" aria-hidden="true">${s.n}</div>
                <div class="tl-copy"><b>${s.label}</b><small>${s.sub}</small></div>
              </a>`;
    }
    return `<div class="${cls}" ${s.current?'aria-current="step"':''}>
              <div class="tl-dot" aria-hidden="true">${s.n}</div>
              <div class="tl-copy"><b>${s.label}</b><small>${s.sub}</small></div>
            </div>`;
  }).join('');
})();
</script>

</body>
</html>
