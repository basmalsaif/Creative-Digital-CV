<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Creative Digital CV ‚Äî Cover Letter Builder</title>

  <!-- Branding / social -->
  <link rel="icon" href="icons/logo.png">
  <meta name="theme-color" content="#7c3aed">
  <meta property="og:title" content="Creative Digital CV ‚Äî Cover Letter Builder">
  <meta property="og:description" content="Generate tailored, ATS-friendly cover letters from your CV data.">
  <meta property="og:image" content="icons/preview.png">

  <!-- Font + shared styles -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/app.css">

  <!-- Page-specific tweaks -->
  <style>
    /* Layout */
    .page{max-width:1200px;margin:0 auto;padding:26px 18px 80px}
    .hero{display:grid;grid-template-columns:1.2fr .9fr;gap:22px;align-items:start}
    @media (max-width:1050px){.hero{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid #e8ecf3;box-shadow:var(--shadow);border-radius:18px;padding:20px}
    .card h2{margin:0 0 10px;font-size:22px}
    .sub{color:var(--muted);margin:0 0 14px}

    /* Form */
    label{font-weight:700;display:block;margin:10px 0 6px}
    .hint{color:var(--muted);font-size:13px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
    input,select,textarea{
      width:100%;border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;font:inherit
    }
    textarea{min-height:140px;resize:vertical}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .chip{display:inline-flex;align-items:center;gap:8px;font-size:13px;padding:6px 10px;border-radius:999px;background:#eef2ff;border:1px solid #dbe4ff}
    .chip button{border:none;background:transparent;cursor:pointer;font-weight:800;line-height:1}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn-line{padding:10px 14px;border:1px dashed #cbd5e1;background:#fff;border-radius:12px;font-weight:700;cursor:pointer}
    .btn-secondary{padding:10px 14px;border:1px solid #e5e7eb;background:#fff;border-radius:12px;font-weight:700;color:var(--brand);cursor:pointer;text-decoration:none}
    .btn-secondary:hover{text-decoration:none}
    .meta{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0;color:var(--muted);font-size:13px}

    /* Preview */
    .preview{background:#fff;border:1px solid #e8ecf3;border-radius:14px;padding:16px;min-height:340px;white-space:pre-wrap;line-height:1.55}
    .preview-head{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:8px}
    .counter{margin-left:auto;color:var(--muted);font-size:12px}

    /* Header chip (back) parity */
    .back a{
      display:inline-block;padding:8px 14px;border-radius:12px;background:rgba(255,255,255,.12);
      color:#fff;font-weight:700;text-decoration:none;border:1px solid rgba(255,255,255,.3);transition:.25s ease;
    }
    .back a:hover,.back a:focus-visible{background:rgba(255,255,255,.22);box-shadow:var(--ring)}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- Shared Header -->
  <header class="header" role="banner">
    <div class="brand">
      <img src="icons/logo.png" alt="Creative Digital CV logo" />
      <span>Creative Digital CV</span>
    </div>

    <button class="hamburger" id="hamburger" aria-label="Toggle menu" aria-expanded="false" aria-controls="mainnav">‚ò∞</button>

    <nav class="nav" id="mainnav" aria-label="Main">
      <a href="index.html">Dashboard</a>
      <a href="cv-templates.html">CV Templates</a>
      <a href="career-path.html">Career Path</a>
      <a href="support.html">Support</a>
    </nav>

    <div class="back"><a href="index.html">Back to site</a></div>
  </header>

  <!-- Main -->
  <main id="main" class="page" role="main" aria-labelledby="page-title">
    <h1 id="page-title" style="margin:6px 0 14px;">Cover Letter Builder</h1>
    <p class="sub">Generate a tailored cover letter using your saved CV info. Adjust tone, add keywords, and export.</p>

    <section class="hero" aria-label="Cover letter form and preview">
      <!-- Left: Form -->
      <section class="card" aria-label="Cover letter inputs">
        <h2>Inputs</h2>
        <p class="sub">We‚Äôll prefill your name & contacts from the CV builder if available.</p>

        <div class="row">
          <div>
            <label for="jobTitle">Target Job Title</label>
            <input id="jobTitle" type="text" placeholder="e.g., SOC Analyst / Cloud Engineer">
          </div>
          <div>
            <label for="company">Company</label>
            <input id="company" type="text" placeholder="e.g., STC">
          </div>
        </div>

        <div class="row">
          <div>
            <label for="hiringMgr">Hiring Manager (optional)</label>
            <input id="hiringMgr" type="text" placeholder="e.g., Ms. Al-Saud">
          </div>
          <div>
            <label for="location">Location (optional)</label>
            <input id="location" type="text" placeholder="City, Country">
          </div>
        </div>

        <div class="row">
          <div>
            <label for="tone">Tone</label>
            <select id="tone">
              <option value="professional" selected>Professional</option>
              <option value="confident">Confident</option>
              <option value="enthusiastic">Enthusiastic</option>
              <option value="concise">Concise</option>
            </select>
          </div>
          <div>
            <label for="length">Length</label>
            <select id="length">
              <option value="short">Short (150‚Äì220 words)</option>
              <option value="standard" selected>Standard (220‚Äì320 words)</option>
              <option value="detailed">Detailed (320‚Äì420 words)</option>
            </select>
          </div>
        </div>

        <label for="highlights">Achievements / Highlights (optional)</label>
        <textarea id="highlights" placeholder="Add 1‚Äì3 short bullets or a paragraph with your strongest achievements for this role‚Ä¶"></textarea>

        <label for="keywords" style="margin-top:10px">Keywords to include (comma-separated)</label>
        <input id="keywords" type="text" placeholder="e.g., SIEM, Splunk, incident response, AWS, Linux">

        <div class="chips" id="kwChips" aria-live="polite" style="display:none"></div>

        <div class="actions">
          <button class="btn-line" type="button" id="useFromCV">Use CV summary & skills</button>
          <button class="btn-primary" type="button" id="generate">Generate Preview</button>
        </div>

        <div class="meta" id="whoami" aria-live="polite"></div>
      </section>

      <!-- Right: Preview -->
      <section class="card" aria-label="Cover letter preview">
        <div class="preview-head">
          <h2 style="margin:0">Preview</h2>
          <div class="counter" id="wc">0 words</div>
        </div>
        <div id="preview" class="preview" role="document" aria-label="Cover letter preview area">
Dear Hiring Manager,

Use the form to generate your tailored cover letter here.
        </div>

        <div class="actions">
          <button class="btn-secondary" type="button" id="copyBtn">Copy</button>
          <button class="btn-primary" type="button" id="downloadBtn">Download .txt</button>
          <a class="btn-secondary" href="build-cv.html" target="_blank" rel="noopener">Open CV Preview</a>
        </div>
      </section>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="foot">
      <div>¬© 2025 Creative Digital CV ‚Äî Version 1.0 Beta | Made with love in SEU üíú</div>
      <div style="display:flex;gap:16px;flex-wrap:wrap">
        <a href="terms.html">Terms & Conditions</a>
        <a href="privacy.html">Privacy</a>
        <a href="faqs.html">FAQs</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <!-- Shared JS -->
  <script src="js/app.js"></script>

  <!-- Page logic -->
  <script>
    (function(){
      const $ = s => document.querySelector(s);

      // Elements
      const jobTitle  = $('#jobTitle');
      const company   = $('#company');
      const hiringMgr = $('#hiringMgr');
      const location  = $('#location');
      const tone      = $('#tone');
      const lengthSel = $('#length');
      const highlights= $('#highlights');
      const keywords  = $('#keywords');
      const kwChips   = $('#kwChips');
      const whoami    = $('#whoami');
      const preview   = $('#preview');
      const wcEl      = $('#wc');

      const useFromCV = $('#useFromCV');
      const generate  = $('#generate');
      const copyBtn   = $('#copyBtn');
      const downloadBtn = $('#downloadBtn');

      // Prefill from builder
      let profile = { name:'', email:'', phone:'', loc:'', linkedin:'', degree:'', major:'', summary:'', skills:[], experience:[] };
      try{
        const state = JSON.parse(localStorage.getItem('cvsenior-builder') || '{}');
        const p = (state.sections && (state.sections.personal || state.sections.core)) || state.personal || {};
        profile.name  = p.fullName || '';
        profile.email = p.email || '';
        profile.phone = p.phone || '';
        profile.loc   = p.location || '';
        profile.linkedin = p.linkedin || '';
        profile.degree= p.degree || '';
        profile.major = p.major || '';
        profile.summary = (state.sections && state.sections.summary && state.sections.summary.text) || (state.sections && state.sections.profile) || '';
        profile.skills  = (state.sections && state.sections.skills) || [];
        profile.experience = (state.sections && (state.sections.exp || state.sections.experience)) || [];
      }catch{}

      // Show who we are sending as
      whoami.innerHTML = [
        profile.name ? ('<b>'+escapeHtml(profile.name)+'</b>') : '',
        profile.email ? ('üìß '+escapeHtml(profile.email)) : '',
        profile.phone ? ('üìû '+escapeHtml(profile.phone)) : '',
        profile.linkedin ? ('üîó '+escapeHtml(profile.linkedin)) : '',
        profile.loc ? ('üìç '+escapeHtml(profile.loc)) : ''
      ].filter(Boolean).join(' ¬∑ ') || '<span class="hint">No personal info found yet. Fill Step 1 to auto-include header details.</span>';

      // Keywords chips
      keywords.addEventListener('input', renderKw);
      function renderKw(){
        const list = (keywords.value || '').split(',').map(s=>s.trim()).filter(Boolean);
        kwChips.innerHTML = '';
        if(!list.length){ kwChips.style.display='none'; return; }
        kwChips.style.display='flex';
        list.forEach((k,i)=>{
          const chip = document.createElement('span');
          chip.className = 'chip';
          chip.innerHTML = escapeHtml(k) + ' <button title="Remove" data-del="'+i+'">√ó</button>';
          kwChips.appendChild(chip);
        });
        kwChips.querySelectorAll('[data-del]').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const i = +btn.getAttribute('data-del');
            const arr = (keywords.value||'').split(',');
            arr.splice(i,1);
            keywords.value = arr.join(',').replace(/,\s*,/g,',').replace(/^,|,$/g,'').trim();
            renderKw();
          });
        });
      }

      // Use CV summary & skills
      useFromCV.addEventListener('click', ()=>{
        const parts = [];
        if(profile.summary){ parts.push(profile.summary); }
        if(profile.skills && profile.skills.length){
          const top = profile.skills.slice(0,8).join(', ');
          parts.push('Core strengths: ' + top + '.');
        }
        if(parts.length){
          const txt = (highlights.value ? (highlights.value.trim() + '\n') : '') + parts.join('\n');
          highlights.value = txt.trim();
        }
      });

      // Build letter text
      function buildLetter(){
        const jt = jobTitle.value.trim();
        const co = company.value.trim();
        const hm = hiringMgr.value.trim();
        const loc = location.value.trim();
        const kws = (keywords.value||'').split(',').map(s=>s.trim()).filter(Boolean);

        // length target
        const lens = { short:[150,220], standard:[220,320], detailed:[320,420] }[lengthSel.value] || [220,320];

        const greeting = hm ? `Dear ${hm},` : `Dear Hiring Manager,`;
        const headAddr = [
          profile.name && `${profile.name}`,
          profile.email && `${profile.email}`,
          profile.phone && `${profile.phone}`,
          profile.linkedin && `${profile.linkedin}`,
          (profile.loc || loc) && `${loc || profile.loc}`
        ].filter(Boolean).join(' ‚Ä¢ ');

        const roleLine = jt && co ? `${jt} at ${co}` : (jt ? jt : 'the role');
        const opener = {
          professional: `I am writing to express my interest in the ${roleLine}.`,
          confident:    `I‚Äôm the candidate you‚Äôre looking for for ${roleLine}.`,
          enthusiastic: `I‚Äôm excited to apply for ${roleLine}.`,
          concise:      `Applying for ${roleLine}.`
        }[tone.value];

        // Pull 1‚Äì2 experiences if present
        const expBlurb = (profile.experience||[]).slice(0,2).map(e=>{
          const when = [e.start, e.end || 'Present'].filter(Boolean).join('‚Äì');
          const meta = [e.company, e.location].filter(Boolean).join(' ‚Ä¢ ');
          return `‚Ä¢ ${e.title || 'Role'} ‚Äî ${meta} (${when}). ${e.desc || ''}`.trim();
        }).join('\n');

        const hl = highlights.value.trim();
        const kwLine = kws.length ? `Keywords: ${kws.join(', ')}.` : '';

        const close = {
          professional: `I welcome the opportunity to discuss how I can contribute to ${co || 'your team'}. Thank you for your time and consideration.`,
          confident:    `I‚Äôm ready to add value from day one. I look forward to discussing next steps.`,
          enthusiastic: `I would love to bring my energy and skills to ${co || 'your organization'}. Thank you for your consideration.`,
          concise:      `Thank you for your consideration.`
        }[tone.value];

        const sign = `Sincerely,\n${profile.name || ''}`;

        let body = [
          headAddr ? headAddr + '\n' : '',
          greeting,
          '',
          opener,
          '',
          hl ? hl : '',
          expBlurb ? expBlurb : '',
          kwLine,
          '',
          close,
          '',
          sign
        ].filter(Boolean).join('\n');

        // length nudge (very lightweight): if under target, append skills sentence
        const w = wordCount(body);
        if(w < lens[0] && profile.skills && profile.skills.length){
          body += `\n\nSelected skills: ${profile.skills.slice(0,10).join(', ')}.`;
        }

        return body.trim().replace(/\n{3,}/g, '\n\n');
      }

      function wordCount(s){ return (s.trim().match(/\b[\w'-]+\b/g)||[]).length; }
      function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]));}

      function render(){
        const txt = buildLetter();
        preview.textContent = txt;
        wcEl.textContent = wordCount(txt) + ' words';
      }

      generate.addEventListener('click', render);
      ['input','change'].forEach(ev=>{
        [jobTitle,company,hiringMgr,location,tone,lengthSel,highlights,keywords].forEach(el=>{
          el.addEventListener(ev, ()=>{ /* live drafting without heavy recompute */ });
        });
      });

      copyBtn.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(preview.textContent || '');
          copyBtn.textContent = 'Copied!';
          setTimeout(()=>copyBtn.textContent='Copy', 1200);
        }catch{}
      });

      downloadBtn.addEventListener('click', ()=>{
        const blob = new Blob([preview.textContent||''], {type:'text/plain;charset=utf-8'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        const co = (company.value||'').trim().replace(/\s+/g,'-');
        const jt = (jobTitle.value||'').trim().replace(/\s+/g,'-');
        a.download = `cover-letter${jt?'-'+jt:''}${co?'-'+co:''}.txt`;
        document.body.appendChild(a); a.click(); a.remove();
      });

      // Initial render
      render();
    })();
  </script>
</body>
</html>
