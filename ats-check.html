<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Creative Digital CV — ATS Check</title>

  <!-- Branding -->
  <link rel="icon" href="icons/logo.png">
  <meta name="theme-color" content="#7c3aed">

  <!-- Google Font + App CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/app.css">

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <style>
    .header{
      backdrop-filter: blur(6px);
      background: linear-gradient(90deg,#f3e8ff 0%, #a78bfa 50%, #7c3aed 100%);
      padding:10px 18px;display:flex;align-items:center;gap:18px;justify-content:space-between;
    }
    main.wrap{padding-top:14px}
    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:22px}
    @media (max-width:1000px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #e8ecf3;border-radius:18px;padding:20px}
    .card h2{margin:0 0 10px}
    textarea,input[type="text"]{width:100%;border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px;font:inherit}
    textarea{min-height:160px;resize:vertical}
    .btn-secondary{padding:10px 14px;border:1px solid #e5e7eb;background:#fff;border-radius:12px;font-weight:700;color:var(--brand);cursor:pointer}
    .btn-primary{padding:10px 14px;border:none;background:var(--brand);border-radius:12px;font-weight:700;color:#fff;cursor:pointer}
    .item{display:flex;gap:10px;align-items:flex-start;background:#fff;border:1px solid #eef2f7;border-radius:12px;padding:10px 12px;margin-top:6px}
    .warn{border-color:#fde68a;background:#fffbeb}
    .good{border-color:#bbf7d0;background:#f0fdf4}
    .bad{border-color:#fecaca;background:#fff1f2}
    .ring{--size:74px;width:var(--size);height:var(--size);border-radius:50%;background:conic-gradient(var(--brand) var(--deg,0deg),#eef2f7 0deg);display:grid;place-items:center}
    footer{padding:20px;text-align:center;font-size:14px;background:#f8fafc;margin-top:40px}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="brand"><img src="icons/logo.png" alt="logo" style="height:32px;"> <b>Creative Digital CV</b></div>
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="cv-templates.html">CV Templates</a>
      <a href="career-path.html">Career Path</a>
      <a href="support.html">Support</a>
    </nav>
  </header>

  <!-- Main -->
  <main class="wrap">
    <section class="grid">
      <!-- Left side -->
      <div class="card">
        <h1>ATS Checker</h1>
        <p>Paste or upload your resume and job description to get an ATS compatibility score.</p>

        <label for="resumeFile" class="btn-secondary">Upload Resume (.txt or .pdf)</label>
        <input type="file" id="resumeFile" accept=".txt,.pdf" style="display:none;">

        <label>Your Resume</label>
        <textarea id="resume" placeholder="Paste your resume text here..."></textarea>

        <label>Job Description</label>
        <textarea id="jd" placeholder="Paste the job description here..."></textarea>

        <button id="checkBtn" class="btn-primary" type="button">Run ATS Check</button>
      </div>

      <!-- Right side -->
      <aside class="card">
        <h2>Results</h2>
        <div class="ring" id="ring"><b id="score">0</b></div>
        <div id="findings" class="findings">
          <div class="item warn">
            <div>⚠️</div>
            <div><b>No results yet</b><br>Upload or paste your resume and JD, then run the check.</div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    © 2025 Creative Digital CV — All Rights Reserved.
  </footer>

  <script src="js/app.js"></script>
  <script>
    const resumeEl = document.getElementById('resume');
    const jdEl = document.getElementById('jd');
    const scoreEl = document.getElementById('score');
    const ring = document.getElementById('ring');
    const findings = document.getElementById('findings');

    // --- PDF extraction function using PDF.js ---
    async function extractPdfText(file) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      let textContent = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const text = await page.getTextContent();
        textContent += text.items.map(item => item.str).join(' ') + '\n';
      }
      return textContent.trim();
    }

    // --- File Upload Handling ---
    document.getElementById('resumeFile').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const ext = file.name.split('.').pop().toLowerCase();
      if (ext === 'txt') {
        const text = await file.text();
        resumeEl.value = text;
      } else if (ext === 'pdf') {
        resumeEl.value = 'Extracting PDF text... please wait';
        try {
          const text = await extractPdfText(file);
          resumeEl.value = text;
        } catch (err) {
          resumeEl.value = '';
          alert('Error reading PDF file. Try exporting it as text.');
        }
      } else {
        alert('Unsupported file format. Use .txt or .pdf');
      }
    });

    // --- Scoring Logic ---
    function tokenize(text) {
      return text.toLowerCase().match(/\b[a-z0-9\+\#]+\b/g) || [];
    }

    function scoreATS(resume, jd) {
      const resumeWords = tokenize(resume);
      const jdWords = tokenize(jd);
      const overlap = jdWords.filter(word => resumeWords.includes(word));
      const score = Math.min(100, Math.round((overlap.length / jdWords.length) * 100));
      return { score, overlap };
    }

    function renderResults(result) {
      scoreEl.textContent = result.score;
      ring.style.setProperty('--deg', `${(result.score / 100) * 360}deg`);
      findings.innerHTML = '';
      const div = document.createElement('div');
      div.className = 'item ' + (result.score > 70 ? 'good' : result.score > 40 ? 'warn' : 'bad');
      div.innerHTML = `
        <div>${result.score > 70 ? '✅' : result.score > 40 ? '⚠️' : '❌'}</div>
        <div>
          <b>Keyword Match: ${result.score}%</b><br>
          ${result.score > 70 ? 'Great alignment! Your resume fits well with the JD.' :
            result.score > 40 ? 'Good start — consider adding some missing keywords.' :
            'Low alignment. Revise your resume to better match the JD.'}
        </div>`;
      findings.appendChild(div);
    }

    document.getElementById('checkBtn').addEventListener('click', () => {
      const resume = resumeEl.value.trim();
      const jd = jdEl.value.trim();
      if (resume.length < 30 || jd.length < 30) {
        alert('Please paste both resume and job description first.');
        return;
      }
      const result = scoreATS(resume, jd);
      renderResults(result);
    });
  </script>
</body>
</html>
